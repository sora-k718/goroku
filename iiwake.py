# -*- coding: utf-8 -*-
"""iiwake.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1h5aE8rbZCv_lflSjcAwiL4ppJoLsvods
"""

# ðŸ”§ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœ€åˆã ã‘å°‘ã—æ™‚é–“ã‹ã‹ã‚‹ï¼‰
!pip install openai streamlit pyngrok --quiet

# ðŸ” OpenAI APIã‚­ãƒ¼ã‚’å…¥åŠ›ï¼ˆâ€»è‡ªåˆ†ã®ã‚­ãƒ¼ã‚’å…¥åŠ›ï¼‰
import os
os.environ["OPENAI_API_KEY"] = input("ðŸ”‘ OpenAI APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: ")

# ðŸ’» Streamlitã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
app_code = '''
import streamlit as st
import openai
import os

openai.api_key = os.getenv("OPENAI_API_KEY")

st.title("ðŸ§  GPTè¨€ã„è¨³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼")
st.write("çŠ¶æ³ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€GPTãŒè‡ªç„¶ãªè¨€ã„è¨³ã‚’è€ƒãˆã¾ã™ã€‚")

situation = st.text_area("â“ è¨€ã„è¨³ã—ãŸã„çŠ¶æ³ã¯ï¼Ÿ")
tone = st.selectbox("ðŸ—£ï¸ æ–‡ä½“ã¯ï¼Ÿ", ["æ•¬èªž", "ã‚¿ãƒ¡å£", "ã©ã£ã¡ã§ã‚‚"])

if st.button("GPTã«ç›¸è«‡ï¼") and situation.strip():
    with st.spinner("è€ƒãˆä¸­â€¦"):
        prompt = f"""
ã‚ãªãŸã¯â€œè¨€ã„è¨³ã®ãƒ—ãƒ­â€ã§ã™ã€‚æ¬¡ã®çŠ¶æ³ã«è‡ªç„¶ã§ç´å¾—ã•ã‚Œã‚„ã™ã„è¨€ã„è¨³ã‚’è€ƒãˆã¦ãã ã•ã„ã€‚

çŠ¶æ³: {situation}
å¸Œæœ›ã®æ–‡ä½“: {tone}
"""
        response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.9,
            max_tokens=300,
        )
        st.success(response.choices[0].message.content.strip())
'''

# ã‚¢ãƒ—ãƒªã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜
with open("app.py", "w") as f:
    f.write(app_code)

# ðŸŒ å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ç”¨ã®URLã‚’ä½œæˆï¼ˆngrokä½¿ç”¨ï¼‰
from pyngrok import ngrok
public_url = ngrok.connect(8501)
print("ðŸ”— ã“ã®URLã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚¢ãƒ—ãƒªãŒé–‹ãã¾ã™ï¼š", public_url)

# ðŸš€ Streamlitã‚¢ãƒ—ãƒªã‚’èµ·å‹•
!streamlit run app.py &> /dev/null &