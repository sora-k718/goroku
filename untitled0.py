# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14vwPvodJe9Fb0AKP8pHuYbz83CKJgOB5
"""

# prompt: import streamlit as st
# import openai
# # âœ… OpenAI APIã‚­ãƒ¼ï¼ˆç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã™ã‚‹ã‹ç›´æ›¸ãï¼‰
# openai.api_key = "your-api-key-here"  # â†ã“ã“ã‚’è‡ªåˆ†ã®APIã‚­ãƒ¼ã«å¤‰æ›´ï¼
# # ã‚¿ã‚¤ãƒˆãƒ«
# st.title("ğŸ§  GPTè¨€ã„è¨³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼")
# st.write("çŠ¶æ³ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€GPTãŒ â€œæœ€ã‚‚ç´å¾—ã•ã‚Œã‚„ã™ã„è¨€ã„è¨³â€ ã‚’è‡ªå‹•ã§è€ƒãˆã¾ã™ã€‚")
# # å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
# situation = st.text_area("â“ ã©ã‚“ãªè¨€ã„è¨³ã‚’è€ƒãˆã¦ã»ã—ã„ï¼Ÿï¼ˆä¾‹ï¼šãƒã‚¤ãƒˆã‚’ä¼‘ã¿ãŸã„ã‘ã©ã‚µãƒœã‚ŠãŸã„ï¼‰")
# # æ–‡ä½“é¸æŠ
# tone = st.selectbox("ğŸ—£ï¸ æ–‡ä½“ã®æŒ‡å®š", ["æ•¬èªï¼ˆä¸å¯§ï¼‰", "ã‚¿ãƒ¡å£ï¼ˆãƒ•ãƒ©ãƒ³ã‚¯ï¼‰", "ã©ã£ã¡ã§ã‚‚"])
# # å®Ÿè¡Œãƒœã‚¿ãƒ³
# if st.button("GPTã«è¨€ã„è¨³ã‚’ç›¸è«‡ï¼") and situation.strip() != "":
#     with st.spinner("è¨€ã„è¨³ã‚’è€ƒãˆä¸­â€¦"):
#         # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
#         prompt = f"""
# ã‚ãªãŸã¯â€œè¨€ã„è¨³ã‚’è€ƒãˆã‚‹ãƒ—ãƒ­â€ã§ã™ã€‚ä»¥ä¸‹ã®çŠ¶æ³ã«å¯¾ã—ã¦ã€ç´å¾—ã•ã‚Œã‚„ã™ãã€è‡ªç„¶ã§ãƒãƒ¬ã«ãã„è¨€ã„è¨³ã‚’1ã¤è€ƒãˆã¦ãã ã•ã„ã€‚
# ã€çŠ¶æ³ã€‘{situation}
# ã€å¸Œæœ›ã®æ–‡ä½“ã€‘{tone}
# â€»ã‚·ãƒ³ãƒ—ãƒ«ã§è‡ªç„¶ã«ã€ã§ã‚‚ã¡ã‚‡ã£ã¨ç¬‘ãˆã‚‹ãã‚‰ã„çµ¶å¦™ãªè¨€ã„è¨³ã‚’å‡ºã—ã¦ãã ã•ã„ã€‚
# """
#         # OpenAI APIå‘¼ã³å‡ºã—
#         response = openai.ChatCompletion.create(
#             model="gpt-4",
#             messages=[
#                 {"role": "user", "content": prompt}
#             ],
#             max_tokens=300,
#             temperature=0.9,
#         )
#         # å‡ºåŠ›è¡¨ç¤º
#         excuse = response['choices'][0]['message']['content'].strip()
#         st.subheader("ğŸ’¬ GPTãŒè€ƒãˆãŸæœ€å¼·ã®è¨€ã„è¨³ï¼š")
#         st.success(excuse)

!pip install streamlit openai
!wget https://raw.githubusercontent.com/streamlit/streamlit/main/lib/streamlit/web/bootstrap.py

import streamlit as st
import openai
import subprocess
import os

# âœ… OpenAI APIã‚­ãƒ¼ï¼ˆç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã™ã‚‹ã‹ç›´æ›¸ãï¼‰
# It's highly recommended to manage your API key more securely,
# e.g., using environment variables or Colab secrets.
openai.api_key = os.environ.get("OPENAI_API_KEY", "your-api-key-here") # Replace with your API key or use environment variable

# Create a dummy file for the Streamlit script
with open("streamlit_app.py", "w") as f:
    f.write("""
import streamlit as st
import openai
import os

# âœ… OpenAI APIã‚­ãƒ¼ï¼ˆç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã™ã‚‹ã‹ç›´æ›¸ãï¼‰
openai.api_key = os.environ.get("OPENAI_API_KEY", "your-api-key-here") # Replace with your API key or use environment variable


# ã‚¿ã‚¤ãƒˆãƒ«
st.title("ğŸ§  GPTè¨€ã„è¨³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼")
st.write("çŠ¶æ³ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€GPTãŒ â€œæœ€ã‚‚ç´å¾—ã•ã‚Œã‚„ã™ã„è¨€ã„è¨³â€ ã‚’è‡ªå‹•ã§è€ƒãˆã¾ã™ã€‚")

# å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
situation = st.text_area("â“ ã©ã‚“ãªè¨€ã„è¨³ã‚’è€ƒãˆã¦ã»ã—ã„ï¼Ÿï¼ˆä¾‹ï¼šãƒã‚¤ãƒˆã‚’ä¼‘ã¿ãŸã„ã‘ã©ã‚µãƒœã‚ŠãŸã„ï¼‰")

# æ–‡ä½“é¸æŠ
tone = st.selectbox("ğŸ—£ï¸ æ–‡ä½“ã®æŒ‡å®š", ["æ•¬èªï¼ˆä¸å¯§ï¼‰", "ã‚¿ãƒ¡å£ï¼ˆãƒ•ãƒ©ãƒ³ã‚¯ï¼‰", "ã©ã£ã¡ã§ã‚‚"])

# å®Ÿè¡Œãƒœã‚¿ãƒ³
if st.button("GPTã«è¨€ã„è¨³ã‚’ç›¸è«‡ï¼") and situation.strip() != "":
    if openai.api_key == "your-api-key-here" or openai.api_key is None:
        st.error("Please replace 'your-api-key-here' with your actual OpenAI API key or set the OPENAI_API_KEY environment variable.")
    else:
        with st.spinner("è¨€ã„è¨³ã‚’è€ƒãˆä¸­â€¦"):
            try:
                # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
                prompt = f\"\"\"
ã‚ãªãŸã¯â€œè¨€ã„è¨³ã‚’è€ƒãˆã‚‹ãƒ—ãƒ­â€ã§ã™ã€‚ä»¥ä¸‹ã®çŠ¶æ³ã«å¯¾ã—ã¦ã€ç´å¾—ã•ã‚Œã‚„ã™ãã€è‡ªç„¶ã§ãƒãƒ¬ã«ãã„è¨€ã„è¨³ã‚’1ã¤è€ƒãˆã¦ãã ã•ã„ã€‚
ã€çŠ¶æ³ã€‘{situation}
ã€å¸Œæœ›ã®æ–‡ä½“ã€‘{tone}
â€»ã‚·ãƒ³ãƒ—ãƒ«ã§è‡ªç„¶ã«ã€ã§ã‚‚ã¡ã‚‡ã£ã¨ç¬‘ãˆã‚‹ãã‚‰ã„çµ¶å¦™ãªè¨€ã„è¨³ã‚’å‡ºã—ã¦ãã ã•ã„ã€‚
\"\"\"
                # OpenAI APIå‘¼ã³å‡ºã—
                response = openai.ChatCompletion.create(
                    model="gpt-4", # You might need to change the model based on availability and cost
                    messages=[
                        {"role": "user", "content": prompt}
                    ],
                    max_tokens=300,
                    temperature=0.9,
                )
                # å‡ºåŠ›è¡¨ç¤º
                excuse = response['choices'][0]['message']['content'].strip()
                st.subheader("ğŸ’¬ GPTãŒè€ƒãˆãŸæœ€å¼·ã®è¨€ã„è¨³ï¼š")
                st.success(excuse)
            except Exception as e:
                st.error(f"An error occurred: {e}")

""")


# Run Streamlit
# You might need to adjust the command based on your environment
try:
    # This command runs streamlit as a background process.
    # You'll need to click the link provided in the output to access the app.
    # Make sure to stop the cell execution when you are done.
    process = subprocess.Popen(['streamlit', 'run', 'streamlit_app.py', '--server.port', '8501'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)

    # Read the output to get the public URL
    for line in iter(process.stdout.readline, b''):
        print(line.decode('utf-8'), end='')
        if "External URL:" in line.decode('utf-8'):
            break # Stop reading output once the URL is found

except Exception as e:
    print(f"Error running Streamlit: {e}")
    print("Please ensure you have replaced 'your-api-key-here' with a valid OpenAI API key.")

# Note: To interact with the Streamlit app, you will need to use ngrok or a similar service
# to expose the port 8501 if you are running this in a cloud environment without direct port forwarding.
# In Google Colab, after running this cell, look for the "External URL" in the output and click it.
# If you don't see the URL, you might need to manually set up port forwarding (e.g., using ngrok).
# A common way to use ngrok in Colab is:
# !wget https://bin.equinox.io/c/4VmDwCvkvbG/ngrok-stable-linux-amd64.zip
# !unzip ngrok-stable-linux-amd64.zip
# get_ipython().system_raw('./ngrok http 8501 &')
# !curl -s http://localhost:4040/api/tun/http | python3 -c 'import json, sys; j=json.load(sys.stdin); print(j["tunnels"][0]["public_url"])'
# Then use the URL provided by the curl command.

# Make sure to terminate the cell execution (click the stop button) when you are finished
# with the Streamlit application to release resources.